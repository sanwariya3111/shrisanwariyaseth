{% extends 'master.html' %}
{% block css %}
<style>
   .grid-container {
  margin: 5% 3%;
}

.grid-container {
  margin: 2%;
}


.grid-container {
  margin: 2em auto;
  max-width: 75em;
}


.responsive-table {
  width: 100%;
  margin-bottom: 1.5em;
  border-spacing: 0;
}

.responsive-table {
  font-size: 0.8em;
}

.responsive-table thead {
  position: absolute;
  padding: 0;
  border: 0;
  height: 1px;
  width: 1px;
  overflow: hidden;
}

.responsive-table thead {
  position: relative;
  clip: auto;
  height: auto;
  width: auto;
  overflow: auto;
}

.responsive-table thead th {
  background-color: #26890d;
  border: 1px solid #86bc25;
  font-weight: normal;
  text-align: center;
  color: white;
}

.responsive-table thead th:first-of-type {
  text-align: left;
  
}

.responsive-table tbody,
.responsive-table tr,
.responsive-table th,
.responsive-table td {
  display: block;
  padding: 0;
  text-align: left;
  white-space: normal;
}

.responsive-table tr {
  display: table-row;
}

.responsive-table tbody tr:hover {
  background-color: rgba(255, 255, 255, 0.3);
}

.responsive-table th,
.responsive-table td {
  padding: 0.5em;
  vertical-align: middle;
}


.responsive-table th,
.responsive-table td {
  display: table-cell;
  padding: 0.5em;
}


.responsive-table caption {
  margin-bottom: 1em;
  font-size: 1em;
  font-weight: bold;
  text-align: center;
}

.responsive-table caption {
  font-size: 1.5em;
}

.responsive-table tfoot {
  font-size: 0.8em;
  font-style: italic;
}

.responsive-table tfoot {
  font-size: 0.9em;
}


.responsive-table tbody {
  display: table-row-group;
}

.responsive-table tbody tr {
  margin-bottom: 1em;
}

.responsive-table tbody tr {
  display: table-row;
  border-width: 1px;
}

.responsive-table tbody tr:last-of-type {
  margin-bottom: 0;
}

.responsive-table tbody tr:nth-of-type(even) {
  background-color: rgba(0, 0, 0, 0.12);
}

.responsive-table tbody th[scope=row] {
  background-color: #26890d;
  color: white;
}

.responsive-table tbody th[scope=row] {
  border-left: 1px solid #86bc25;
  border-bottom: 1px solid #86bc25;
}


.responsive-table tbody th[scope=row] {
  background-color: transparent;
  color: #000001;
  text-align: left;
}

.responsive-table tbody td {
  text-align: right;
}

.responsive-table tbody td {
  border-left: 1px solid #86bc25;
  border-bottom: 1px solid #86bc25;
  text-align: center;
}


.responsive-table tbody td:last-of-type {
  border-right: 1px solid #86bc25;
}

.responsive-table tbody td[data-type=currency] {
  text-align: right;
}

#btnModify {
    padding: 5px;
    background-color: #4caf50;
    color: white;
    border: none;
    cursor: pointer;
    border-radius: 10px;
  }
  .header2 {
  margin-top: 30px;
  margin-left: auto;
  margin-right: auto;
  width: 60%;
  padding: 10px;
  display: flex;
  flex-direction: row;
  flex-wrap: wrap;
  align-items: center;
  justify-content: center;
}

.header2 items {
  background: gray;
  box-sizing: border-box;
  width: 45%;
}
#btnAdd {
    padding: 5px;
    background-color: #4caf50;
    color: white;
    border: none;
    cursor: pointer;
    border-radius: 10px;
  }
  .messages {
  margin-left: auto;
  margin-right: auto;
  width: 25%;
  color: rgb(227, 240, 252);
}
.errormessage-bg
{
    background-color: lightcoral;
}
.successmessage-bg
{
    background-color: #26890d;
}
</style>
{% endblock css %}

{% block bodycontent %}
<div class="header2">
    <div class= "items">
    <span>Add admin user : </span>
    </div>
    <div class= "items">
    <input type ="textbox" id="txtInputAdmin"/>
    <input type="button" id="btnAdd" value="Add" />
    </div>
</div>
<div class="messages" id="addBtnMessage">
    <!-- <span class="successmessage-bg">**Error : response.message</span> -->
</div>
<div class ="container">
    <div class="grid-container">
        <table class="responsive-table" id="adminUsersTable">
          <caption>Admin Users - Add / Modify </caption>
          <thead>
            <tr>
              <th >User Name</th>
              <th >Role</th>
              <th >Active</th>
              <th >CreatedDatetime</th>
              <th >ModifiedDatetime</th>
              <th></th>
            </tr>
          </thead>
          <tfoot>
            <tr>
            
            </tr>
          </tfoot>
          <tbody>
            {% for x in data %} 
             {% if x %}
            <tr id={{x.id}}>
              <th scope="row">{{x.username}}</th>
              <td >{{x.role}}</td>
              <td >{{x.active}}</td>
              <td >{{x.createddatetime}}</td>
              <td >{{x.modifieddatetime}}</td>
              {% if x.role == 'admin' and x.active == 'Yes' %}
              <td> <button id="btnModify" data-active={{x.active}} data-username={{x.username}}>Disable</button></td>
              {% endif %}
              {% if x.role == 'admin' and x.active == 'No' %}
              <td> <button id="btnModify" data-active={{x.active}} data-username={{x.username}}>Enable</button></td>
              {% endif %}
            </tr>
             {% endif %}
            {%endfor %}
          </tbody>
        </table>
      </div>
</div>
{% endblock bodycontent %}
{% block javascript %}
<script>
$(document).ready(function () {
    $("#adminUsersTable").on("click","#btnModify",function() {
      sender = $(this);
      var form_data = new FormData();
      adminuser = $(this).attr("data-username");
      active = $(this).attr("data-active");
      form_data.append("adminuser",adminuser);
      form_data.append("active",active);
      $.ajax({
        url: "/modify_admin/", 
        type: "POST",
        headers: { "X-CSRFToken": $.cookie("csrftoken") },
        data: form_data,
        processData: false,
        contentType: false,
        dataType: "json",
        success: function (response) {
          if(response.result ==1)
          {
            let tr = $(response.html);
            //let row = $(template).html();
            //alert($(response.html).html());
          sender.parent().parent().html('').html(tr.html());
            //alert(sender.parent().append(response.html);
            //alert(response.html);
          }
        },
        error: function (error) {
          uploadStatus.text("failed.");
          console.log(error);
        },
      });
    });
    $('#btnAdd').click(function () {
      var form_data = new FormData();
      adminuser = $("#txtInputAdmin").val();
      form_data.append("adminuser",adminuser);
      $.ajax({
        url: "/add_admin/", 
        type: "POST",
        headers: { "X-CSRFToken": $.cookie("csrftoken") },
        data: form_data,
        processData: false,
        contentType: false,
        dataType: "json",
        success: function (response) {
            if(response.result ==0)
            {
                $('#addBtnMessage').html('');
                $('#addBtnMessage').append('<span  class="errormessage-bg">**Error : '+response.message+'</span>');
            }
            else
            {
            $("#txtInputAdmin").val('');
            $('#addBtnMessage').html('');
            $('#addBtnMessage').append('<span  class="successmessage-bg">Success : '+response.message+'</span>');
            $("#adminUsersTable > tbody").prepend(response.html);
            }
        },
        error: function (error) {
          uploadStatus.text("failed.");
          console.log(error);
        },
      });
    });
});
</script>
{% endblock javascript %}